<!DOCTYPE html>
<html>

<head>
  <title>狼人杀大屏幕 狼叔开发 vrcats</title>  
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
  <style>
  div.pad { margin:4px; padding:4px; font-size: 32px; width: 19%; height: 32; text-align: center; border-radius: 10%; background-color: rgba(10, 10, 80, 0.8); border-style: solid; border-color: gray; color: orange; visibility: hidden}
  img.avarta { object-fit: scale-down; max-width: 80%; max-height: 80%; border-radius: 50%; position: relative;}
  img.addon { display: none; position: absolute; top: 0; right: 0; width:64px; height: 64px;}
  span.big { font-size: 22px; font-weight: 5; color: white;}
  div.c3 { height: 33vh; }
  div.containerdiv { float: left; position: relative; text-align: center; width: 100%;}
  p.comment {font-size: 14px; color: white; opacity: 1}
  .overlay{ opacity:0; background-color:#000000; position:fixed;
    width:100%; height:100%; top:0px; left:0px; z-index:1000; font-size: 40px;}
</style>
</head>
<body style="background:url('background.jpg'); background-repeat: no-repeat; background-size: 100% 100%;">
<div class="overlay" id="curtain"></div>
<div class="row" style="height: 99vh; padding: 10px">
<div class="col-2"><img src="logo.png" width="100%" height="100%"></div>
<div class="col-8 container-fluid" align="center">
  <div class="row c3">
    <div class="pad">1号 <span class="big" id="name_1">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_1" src="ww1.png"><img class="addon" id="addon_1" src="sherrif.png"></div></div>
    <div class="pad">2号 <span class="big" id="name_2">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_2" src="ww1.png"><img class="addon" id="addon_2" src="sherrif.png"></div></div>
    <div class="pad">3号 <span class="big" id="name_3">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_3" src="ww1.png"><img class="addon" id="addon_3" src="sherrif.png"></div></div>
    <div class="pad">4号 <span class="big" id="name_4">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_4" src="ww1.png"><img class="addon" id="addon_4" src="sherrif.png"></div></div>
    <div class="pad">5号 <span class="big" id="name_5">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_5" src="ww1.png"><img class="addon" id="addon_4" src="sherrif.png"></div></div>
  </div>
  <div class="row c3">
    <div class="pad">6号 <span class="big" id="name_6">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_6" src="ww1.png"><img class="addon" id="addon_6" src="sherrif.png"></div></div>
    <div class="pad">7号 <span class="big" id="name_7">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_7" src="ww1.png"><img class="addon" id="addon_7" src="sherrif.png"></div></div>
    <div class="pad">8号 <span class="big" id="name_8">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_8" src="ww1.png"><img class="addon" id="addon_8" src="sherrif.png"></div></div>
    <div class="pad">9号 <span class="big" id="name_9">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_9" src="ww1.png"><img class="addon" id="addon_9" src="sherrif.png"></div></div>
    <div class="pad">10号 <span class="big" id="name_10">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_10" src="ww1.png"><img class="addon" id="addon_10" src="sherrif.png"></div></div>
  </div>
  <div class="row c3">
    <div class="pad">11号 <span class="big" id="name_11">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_11" src="ww1.png"><img class="addon" id="addon_11" src="sherrif.png"></div></div>
    <div class="pad">12号 <span class="big" id="name_12">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_12" src="ww1.png"><img class="addon" id="addon_12" src="sherrif.png"></div></div>
    <div class="pad">13号 <span class="big" id="name_13">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_13" src="ww1.png"><img class="addon" id="addon_13" src="sherrif.png"></div></div>
    <div class="pad">14号 <span class="big" id="name_14">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_14" src="ww1.png"><img class="addon" id="addon_14" src="sherrif.png"></div></div>
    <div class="pad">15号 <span class="big" id="name_15">大灰狼</span><div class="containerdiv"><img class="avarta "  id="img_15" src="ww1.png"><img class="addon" id="addon_15" src="sherrif.png"></div></div>
  </div>
</div>
<div class="col-2" style="border-style: inset; border-color: gray; border-radius: 12px; background-color: rgba(60,60,100,0.8)">
  <p><img src="smileqr.png" width="100%"></p>
  <p align="center" style="font-size: 28px; color: orange">实时得票</p>
  <p align="center" style="font-size: 16px; color: white">vrcats.com/vote.php</p>
  <iframe src="http://vrcats.com/vote_result7935613.php" width="100%" height="55%"></iframe>
</div>
</div>
<div id="ddlg" style="background-color: rgba(20,20,100,0.6); color: white;">This is a dialog</div>



<div id="output" ></div>
</body>
</html>
<script>
jQuery(function($){

  if (!("WebSocket" in window)) {
    alert("Your browser does not support web sockets");
  }else{
    setup();
  }


  function setup(){
   
    // Note: You have to change the host var 
    // if your client runs on a different machine than the websocket server
    
    var host = "ws://localhost:9090/ws";
    var socket = new WebSocket(host);
    //console.log("socket status: " + socket.readyState);   
    
    var $txt = $("#data");
    var $btnSend = $("#sendtext");

    $txt.focus();

    // event handlers for UI
    $btnSend.on('click',function(){
      var text = $txt.val();
      if(text == ""){
        return;
      }
      socket.send(text);
      $txt.val("");    
    });

    $txt.keypress(function(evt){
      if(evt.which == 13){
        $btnSend.click();
      }
    });

    // event handlers for websocket
    if(socket){

      socket.onopen = function(){
        //alert("connection opened....");
        socket.send("GUI");
        showServerResponse("GUI connected");
      }

      socket.onmessage = function(msg){
        update(msg.data);
        //showServerResponse(msg.data);
      }

      socket.onclose = function(){
        //alert("connection closed....");
        //showServerResponse("The connection has been closed.");
      }

    }else{
      console.log("invalid socket");
    }

    function showServerResponse(txt){
      var p = document.createElement('p');
      p.innerHTML = txt;
      document.getElementById('output').appendChild(p); 
    }	
  }
});

$(function () {
  $("#ddlg").dialog({
    autoOpen: false, width: 'auto', height: 900, width: 1200, show: 'fadeIn', hide: 'fadeOut'
  });
  
});
  var interval;
 /*$('#ddlg').on('dialogclose', function(event) {
     countdowncounter=1;
     clearInterval(interval);
 });
 */
 function closeDialog() {
    countdowncounter=1;
    clearInterval(interval);
    $("#ddlg").dialog("close");
 }

  var target_number = 0;
  var time = 90;

	function update(arr) {
		lines = arr.split("\n");
	    for(i = 0; i < lines.length; i++) {
	        a = lines[i].split(" ");
	        name = a[0];
	        value = a[1];
	        if (name.startsWith("img_")) {
		    	document.getElementById(name).src = value;
                document.getElementById(name).parentElement.parentElement.style.visibility = 'visible';
            }
    	    if (name.startsWith("addon_")) {
    			visible("addon", "none");
                if (document.getElementById(name)) {
    				  document.getElementById(name).src = value;
    				  document.getElementById(name).style.display = 'block';
            }
    			}
    		  if (name.startsWith("name_"))
    		    document.getElementById(name).innerHTML = value;
          if (name.startsWith("dlg_")) {
            target_number = value;
            closeDialog();
          }
          if (name.startsWith("dlg_speech")){
            if ($("#ddlg").dialog("isOpen")) {
            }
            time = 90;
            $("#ddlg").load("speech.html").dialog("open");
            $("#ddlg").dialog("open");
          }
          if (name.startsWith("dlg_lastwords")) {
            $("#ddlg").load("lastwords.html").dialog("open");
            $("#ddlg").dialog("open");
          }
          if (name.startsWith("dlg_vote"))
            $("#ddlg").load("vote.html").dialog("open");
          if (name.startsWith("bonus")) {
            if ($("#ddlg").dialog("isOpen")) {
              countdowncounter = countdowncounter + 30;
              $("#ddlg").dialog("open");
            } else {
              $("#ddlg").dialog("close");
              time = 30;
              $("#ddlg").load("speech.html").dialog("open");
            }
          }
          if (name.startsWith("dlg_intro"))
            $("#ddlg").load("slide" + target_number + ".html").dialog("open");
          if (name.startsWith("home"))
            $("#ddlg").dialog("close");
          if (name.startsWith("night"))
            $("#curtain").fadeTo("slow", 0.8);
          if (name.startsWith("day"))
            $("#curtain").fadeTo("slow", 0);
	    }
	}
// TODO: process addon_ display: when received addon_ message, clear all items with classname 'addon', then set the only one
// displayState: 'block' to show, 'none' to hide
function visible(className, displayState){
    var elements = document.getElementsByClassName(className)
    for (var i = 0; i < elements.length; i++){
        elements[i].style.display = displayState;
    }
}

</script>
